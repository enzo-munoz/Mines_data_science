---
title: "TP - Abres de décision et forêts aléatoires"
author: "Enzo Munoz - Hugo Munier - Maxime Guilbaud"
date: "2025-10-21"
output:
  pdf_document:
    latex_engine: xelatex
  html_document:
    html_document:
    toc: true
    toc_float: true
    theme: cosmo
header-includes:
  - \usepackage{float}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(
  fig.width = 7,        
  fig.height = 4.5,
  out.width = "90%",    
  fig.align = "center", 
  fig.pos = "H"       
)
knitr::opts_chunk$set(
  message = FALSE,   
  warning = FALSE    
)
```

The data is related with direct marketing campaigns of a Portuguese banking institution. The 
marketing campaigns were based on phone calls. Often, more than one contact to the same client 
was required, in order to access if the product (bank term deposit) would be ('yes') or not ('no') 
subscribed. The classification goal is to predict if the client will subscribe (yes/no) a term deposit 
(variable y) 

```{r}
data<- read.csv("7 bank_marketing.csv", sep=";")
x<- subset(data, select = -class)
x
y <- data$class
y
```
```{r}
# valeurs manquantes
print("=== Nombre de NA par variable ===")
colSums(is.na(data))
print("=== Nombre de 'unknown' par variable ===")
sapply(data, function(x) sum(x == "unknown", na.rm=TRUE))
```

```{r}
# Charger les bibliothèques
library(ggplot2)
library(dplyr)
library(GGally)

# Charger les données
data <- read.csv("7 bank_marketing.csv", sep = ";")

# Aperçu des données
str(data)
summary(data)

# --- 1️⃣ Distribution des observations par variable ---

# Age
ggplot(data, aes(x = age, fill = class)) +
  geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
  labs(title = "Distribution de l'âge selon la classe", x = "Âge", y = "Fréquence")

# Marital
ggplot(data, aes(x = marital, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Répartition du statut marital selon la classe", x = "Statut marital", y = "Nombre")

# Education
ggplot(data, aes(x = education, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Répartition du niveau d'éducation selon la classe", x = "Éducation", y = "Nombre")

# Default
ggplot(data, aes(x = default, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Présence d’un défaut selon la classe", x = "Défaut", y = "Nombre")

# Balance
ggplot(y$class = no, aes(x = x, y = balance, fill = class)) +
  geom_boxplot() +
  labs(title = "Distribution du solde selon la classe", x = blance, y = histogramme)

# Housing
ggplot(data, aes(x = housing, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Crédit logement selon la classe", x = "Housing", y = "Nombre")

# Loan
ggplot(data, aes(x = loan, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Crédit personnel selon la classe", x = "Loan", y = "Nombre")

# Contact
ggplot(data, aes(x = contact, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Type de contact selon la classe", x = "Contact", y = "Nombre")

# Poutcome
ggplot(data, aes(x = poutcome, fill = class)) +
  geom_bar(position = "dodge") +
  labs(title = "Résultat de la campagne précédente selon la classe", x = "Poutcome", y = "Nombre")

# --- 2️⃣ Boxplot âge / classe ---
ggplot(data, aes(x = class, y = age, fill = class)) +
  geom_boxplot() +
  labs(title = "Boxplot de l'âge selon la classe", x = "Classe", y = "Âge")

# Calcul de la matrice de corrélation
cor_matrix <- cor(X, use = "complete.obs")

# Affichage de la matrice
print(cor_matrix)

# Optionnel : visualisation graphique de la corrélation
ggcorr(X, label = TRUE)

```
on voit si ya loan alors moins de chance de souscrire à un term deposit. 
si ya housing = no plus de chance de souscrire à un term deposit. 
```{r}
library(dplyr)

data <- data %>%
  mutate(across(where(is.character), as.factor))
data
```
Il y a 2 colonnes qui ne sont pas catégorielle la balance et l'âge. Transformer ces features en catégorie implique de couper la feature d'une manière et entraîne une augmentation du nombre d'hyperparamètre. Avant de découper on refait une analyse à priori pour comprendre mieux les tendances. 
```{r}
library(ggplot2)

ggplot(data, aes(x = balance, fill = class)) +
  geom_histogram(bins = 60, alpha = 0.7, position = "identity") +
  labs(
    title = "Distribution du solde (balance) selon la classe",
    x = "Balance",
    y = "Fréquence"
  )

```


```{r}
library(vcd)

# Exemple entre deux variables catégorielles
assocstats(table(data$marital, data$class))

```

Le test du Chi² d’indépendance

Le but du test est de vérifier s’il existe une relation significative entre deux variables catégorielles.
Hypothèses :

H₀ (nulle) : les variables sont indépendantes

H₁ (alternative) : les variables sont associées


